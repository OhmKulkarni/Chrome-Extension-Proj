<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real-Time Update Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        button {
            background: #007cba;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #005a87;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
            font-family: monospace;
            max-height: 200px;
            overflow-y: auto;
        }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .info { color: #17a2b8; }
    </style>
</head>
<body>
    <h1>üìä Real-Time Update Test</h1>
    <p>This page will test if the Chrome Extension is properly capturing and displaying real-time updates for network requests, console errors, and token events.</p>
    
    <div class="test-section">
        <h2>üåê Network Request Tests</h2>
        <button onclick="testFetch()">Test Fetch Request</button>
        <button onclick="testXHR()">Test XHR Request</button>
        <button onclick="testMultipleRequests()">Test Multiple Requests</button>
        <div id="network-log" class="log"></div>
    </div>

    <div class="test-section">
        <h2>üêõ Console Error Tests</h2>
        <button onclick="testConsoleError()">Test Console Error</button>
        <button onclick="testJSError()">Test JavaScript Error</button>
        <button onclick="testMultipleErrors()">Test Multiple Errors</button>
        <div id="error-log" class="log"></div>
    </div>

    <div class="test-section">
        <h2>üîë Token Event Tests</h2>
        <button onclick="testJWTToken()">Test JWT Token</button>
        <button onclick="testAPIKey()">Test API Key</button>
        <button onclick="testSessionToken()">Test Session Token</button>
        <div id="token-log" class="log"></div>
    </div>

    <div class="test-section">
        <h2>üìà Instructions</h2>
        <ol>
            <li><strong>Open Chrome Extension Dashboard</strong> - Open the dashboard in another tab to monitor real-time updates</li>
            <li><strong>Enable Extension</strong> - Make sure the extension is enabled and network interception is active for this tab</li>
            <li><strong>Run Tests</strong> - Click the test buttons above and watch the dashboard for real-time updates</li>
            <li><strong>Check Tables</strong> - Verify that new entries appear in the tables without needing to navigate to another page</li>
        </ol>
        <p><strong>Expected Behavior:</strong> After clicking test buttons, new entries should appear in the dashboard tables immediately, and the counts should update in real-time.</p>
    </div>

    <script>
        const networkLog = document.getElementById('network-log');
        const errorLog = document.getElementById('error-log');
        const tokenLog = document.getElementById('token-log');

        function log(element, message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = type;
            logEntry.innerHTML = `[${timestamp}] ${message}`;
            element.appendChild(logEntry);
            element.scrollTop = element.scrollHeight;
        }

        // Network Request Tests
        async function testFetch() {
            log(networkLog, 'Starting Fetch request test...', 'info');
            try {
                const response = await fetch('https://jsonplaceholder.typicode.com/posts/1');
                const data = await response.json();
                log(networkLog, `‚úÖ Fetch successful: ${response.status} ${response.statusText}`, 'success');
                log(networkLog, `üìÑ Response data: ${JSON.stringify(data).substring(0, 100)}...`, 'info');
            } catch (error) {
                log(networkLog, `‚ùå Fetch failed: ${error.message}`, 'error');
            }
        }

        async function testXHR() {
            log(networkLog, 'Starting XHR request test...', 'info');
            const xhr = new XMLHttpRequest();
            xhr.open('GET', 'https://jsonplaceholder.typicode.com/posts/2');
            xhr.onload = function() {
                if (xhr.status === 200) {
                    log(networkLog, `‚úÖ XHR successful: ${xhr.status} ${xhr.statusText}`, 'success');
                    log(networkLog, `üìÑ Response: ${xhr.responseText.substring(0, 100)}...`, 'info');
                } else {
                    log(networkLog, `‚ùå XHR failed: ${xhr.status} ${xhr.statusText}`, 'error');
                }
            };
            xhr.onerror = function() {
                log(networkLog, `‚ùå XHR error occurred`, 'error');
            };
            xhr.send();
        }

        async function testMultipleRequests() {
            log(networkLog, 'Starting multiple requests test...', 'info');
            const promises = [];
            for (let i = 1; i <= 5; i++) {
                promises.push(
                    fetch(`https://jsonplaceholder.typicode.com/posts/${i}`)
                        .then(r => r.json())
                        .then(data => log(networkLog, `‚úÖ Request ${i} completed`, 'success'))
                        .catch(err => log(networkLog, `‚ùå Request ${i} failed: ${err.message}`, 'error'))
                );
            }
            
            try {
                await Promise.all(promises);
                log(networkLog, 'üéâ All multiple requests completed!', 'success');
            } catch (error) {
                log(networkLog, `‚ùå Some requests failed: ${error.message}`, 'error');
            }
        }

        // Console Error Tests
        function testConsoleError() {
            log(errorLog, 'Generating console error...', 'info');
            console.error('üß™ TEST ERROR: This is a test console error message');
            log(errorLog, '‚úÖ Console error generated', 'success');
        }

        function testJSError() {
            log(errorLog, 'Generating JavaScript error...', 'info');
            try {
                // This will throw a ReferenceError
                nonExistentVariable.someProperty = 'test';
            } catch (error) {
                log(errorLog, `‚úÖ JavaScript error caught: ${error.message}`, 'success');
                // Re-throw to ensure it's captured by the extension
                throw error;
            }
        }

        function testMultipleErrors() {
            log(errorLog, 'Generating multiple errors...', 'info');
            
            // Error 1: Console error
            console.error('üß™ TEST ERROR 1: Multiple error test - console error');
            
            // Error 2: Console warn
            console.warn('üß™ TEST WARNING: Multiple error test - console warning');
            
            // Error 3: JavaScript error
            setTimeout(() => {
                try {
                    undefined.property = 'test';
                } catch (e) {
                    // Let it bubble up
                    throw e;
                }
            }, 100);
            
            log(errorLog, '‚úÖ Multiple errors generated', 'success');
        }

        // Token Event Tests
        function testJWTToken() {
            log(tokenLog, 'Simulating JWT token detection...', 'info');
            
            // Simulate a JWT token in a request
            const fakeJWT = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c';
            
            // Create a request with Authorization header
            fetch('https://jsonplaceholder.typicode.com/posts', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${fakeJWT}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    title: 'Test JWT Post',
                    body: 'Testing JWT token detection',
                    userId: 1
                })
            }).then(response => {
                log(tokenLog, `‚úÖ JWT token request completed: ${response.status}`, 'success');
            }).catch(error => {
                log(tokenLog, `‚ùå JWT token request failed: ${error.message}`, 'error');
            });
            
            log(tokenLog, 'üì§ JWT token request sent', 'info');
        }

        function testAPIKey() {
            log(tokenLog, 'Simulating API key detection...', 'info');
            
            // Simulate an API key in URL params
            fetch('https://jsonplaceholder.typicode.com/posts?api_key=test_api_key_12345&format=json')
                .then(response => response.json())
                .then(data => {
                    log(tokenLog, `‚úÖ API key request completed`, 'success');
                })
                .catch(error => {
                    log(tokenLog, `‚ùå API key request failed: ${error.message}`, 'error');
                });
            
            log(tokenLog, 'üì§ API key request sent', 'info');
        }

        function testSessionToken() {
            log(tokenLog, 'Simulating session token detection...', 'info');
            
            // Simulate a session token in cookie
            document.cookie = 'session_token=sess_test_token_67890; path=/; secure';
            
            // Make a request that would include the cookie
            fetch('https://jsonplaceholder.typicode.com/users/1', {
                credentials: 'include',
                headers: {
                    'X-Session-Token': 'sess_test_token_67890'
                }
            }).then(response => {
                log(tokenLog, `‚úÖ Session token request completed: ${response.status}`, 'success');
            }).catch(error => {
                log(tokenLog, `‚ùå Session token request failed: ${error.message}`, 'error');
            });
            
            log(tokenLog, 'üì§ Session token request sent', 'info');
        }

        // Initialize
        log(networkLog, 'üéØ Network request test panel ready', 'info');
        log(errorLog, 'üéØ Console error test panel ready', 'info');
        log(tokenLog, 'üéØ Token event test panel ready', 'info');
    </script>
</body>
</html>
